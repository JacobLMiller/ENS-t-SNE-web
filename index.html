<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
  <!-- Own CSS -->
  <link rel="stylesheet" href="style.css">

  <title>ENS-t-sne</title>
</head>


<div class="container-fluid" id="main-body">
    ENS-t-SNE web application
    <div class="row" id="main">
         <div class="col-2" id="sidebar" style="height: 100px;">
            <label for="data">Choose a dataset:</label>
            <select name="data" id="data">
                <option value="penguins">Palmer's Penguins</option>
                <option value="synthetic1">Synthetic 1</option>
                <option value="synthetic2">Synthetic 2</option>
                <option value="food">USDA Food Composition</option>
                <option value="auto">Auto-mpg</option>
            </select>
            <br>
            <button id="animateButton">Animate</button>
             <!-- <div class="interpcontainer">
                 <input style="width: 100%;" type="range" min="0" max="1000" value="0" class="slider" id="interp-value"> 
                 <p id="interp-text" style="text-align: center;"></p>
             </div>          
             <div class="play">
                <button id="playButton">play</button>
             </div> -->
         </div>

         <div class="col-10" >
             <svg id="data-view" style="width: 32%; height: 500px; border: 1px solid black;"></svg>
             <svg id="view-1" style="width: 32%; height: 500px;  border: 1px solid black;"></svg>
             <svg id="view-2" style="width: 32%; height: 500px;  border: 1px solid black;"></svg>
         </div>
     </div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>

<script src="3d_visualization.js"></script>
<script src="2d_visualization.js"></script>

<script>

    var attach_script = (data_name, dataView, view1, view2) => {
    
        var script = document.createElement('script');
        
        script.onload = () => {

            console.log(dataView);
            dataView.newData(data,data.projections[0]);
            dataView.draw();

            view1.newData(data,data.projections[0]);
            view1.draw(); 

            view2.newData(data,data.projections[1]);
            view2.draw();

        }

        script.id = "data_script";
        script.src = `${data_name}_data.js`;
        document.head.appendChild(script);

    };

    window.onload = () => {

        var dataView    = new Vis2d("#data-view");
        var view1       = new Vis2d("#view-1");
        var view2       = new Vis2d("#view-2");
        var data_select = document.getElementById("data");

        attach_script(data_select.value, dataView, view1, view2);


        data_select.addEventListener("change", () => {

                attach_script(data_select.value, dataView, view1, view2);
            
            });
        
        let button = document.getElementById("animateButton");
        button.addEventListener("click", () => {
            console.log(data.projections[0]);
            console.log(data.projections[1]);

            let start = data.projections[0];
            let end = data.projections[1];

            // let alpha = 0.5
            // let test = start.map((out, outind) => {
            //     return out.map((inn, innind) => {
            //         return alpha * start[outind][innind] + (1-alpha) * end[outind][innind];
            //     });
            // });
            
            // dataView.updateProjection(test);
            // dataView.updatePositions();
            // dataView.draw();

            const i = d3.interpolate(start, end);
            console.log(i(0.5))
            d3.range(0,1,0.05).forEach((alpha, ind) => {
                setTimeout(() => {
                    dataView.updateProjection(i(alpha));
                    dataView.updatePositions();
                    dataView.draw();
                }, ind * 50);
            });

            data.projections[0] = end;
            data.projections[1] = start;

        })


    };

    

</script>
